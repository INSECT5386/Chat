<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>S3GeN</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Nanum+Myeongjo&display=swap');

html, body {
  margin: 0; padding: 0; height: 100%;
  background: url('https://www.transparenttextures.com/patterns/paper-fibers.png'), #fdf6e3; /* 한지 질감 + 베이지 */
  font-family: 'Nanum Myeongjo', serif;
  color: #2c2c2c;
  overflow: hidden;
}

#appContainer::before {
  display: none; /* 플라즈마 효과 제거 */
}

#chatArea {
  padding: 60px 30px 20px 30px;
  background: transparent;
}

#logoArea {
  filter: none;
  padding-top: 20px;
}

#messages {
  padding: 0 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  height: calc(100vh - 200px);
  overflow-y: auto;
}

.message {
  max-width: 70%;
  padding: 10px 14px;
  border-radius: 12px;
  background: #ffffffd9;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
  font-size: 1rem;
  line-height: 1.5;
  word-break: break-word;
}

.bot {
  align-self: flex-start;
  text-align: left;
  background: #f4f4f4;
  border-left: 4px solid #7fb8a4;
}

.user {
  align-self: flex-end;
  text-align: right;
  background: #fefefe;
  border-right: 4px solid #d0b98c;
}

#inputArea {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 12px 16px;
  background: #f5f0e6;
  border-top: 1px solid #ccc;
  position: fixed; /* 👈 요거 추가! */
  bottom: 0;        /* 👈 화면 아래 고정 */
  width: 100%;      /* 👈 전체 너비 사용 */
  z-index: 10;      /* 👈 혹시 몰라서 위로 띄움 */
}


#inputForm {
  display: flex;
  width: 100%;
  max-width: 720px;
}

#messageInput {
  flex: 1;
  padding: 10px 16px;
  border: 1px solid #ccc;
  border-radius: 12px 0 0 12px;
  font-size: 1rem;
  background: #fff;
  box-shadow: inset 0 0 4px rgba(0, 0, 0, 0.1);
}

#sendBtn {
  padding: 10px 20px;
  border: none;
  border-radius: 0 12px 12px 0;
  font-size: 1rem;
  background: #ded6c8;
  color: #333;
  cursor: pointer;
  transition: all 0.2s ease;
}

#sendBtn:hover {
  background: #cdbda8;
  transform: scale(1.02);
}

.orbit {
  display: none; /* 블랙홀 애니메이션 숨기기 */
}


</style>
</head>
<body>
  <div id="appContainer">
    <div id="logoArea">
      <svg id="s3genLogo" width="220" height="100" viewBox="0 0 220 100" xmlns="http://www.w3.org/2000/svg" aria-label="소담이 별자리" role="img">
        <!-- 별 위치 (옥색) -->
        <circle cx="20" cy="50" r="4" fill="#7fb8a4" />
        <circle cx="60" cy="20" r="4" fill="#7fb8a4" />
        <circle cx="100" cy="40" r="4" fill="#7fb8a4" />
        <circle cx="140" cy="25" r="4" fill="#7fb8a4" />
        <circle cx="180" cy="55" r="4" fill="#7fb8a4" />
        <circle cx="200" cy="80" r="4" fill="#7fb8a4" />
        
        <!-- 별 연결선 -->
        <line x1="20" y1="50" x2="60" y2="20" stroke="#7fb8a4" stroke-width="1.5" />
        <line x1="60" y1="20" x2="100" y2="40" stroke="#7fb8a4" stroke-width="1.5" />
        <line x1="100" y1="40" x2="140" y2="25" stroke="#7fb8a4" stroke-width="1.5" />
        <line x1="140" y1="25" x2="180" y2="55" stroke="#7fb8a4" stroke-width="1.5" />
        <line x1="180" y1="55" x2="200" y2="80" stroke="#7fb8a4" stroke-width="1.5" />
        
        <!-- 한글 로고 -->
        <text x="110" y="95" fill="#7fb8a4" font-family="'Nanum Myeongjo', serif" font-weight="700" font-size="22" letter-spacing="2" text-anchor="middle">
          소담이
        </text>
      </svg>
    </div>

    <div id="chatArea">
      <div id="messages"></div>
    </div>

    <div id="inputArea">
      <form id="inputForm">
        <input
          type="text"
          id="messageInput"
          autocomplete="off"
          placeholder="메시지를 입력하세요..."
        />
        <button type="submit" id="sendBtn">전송</button>
      </form>
    </div>

</body>



<script>
  const messagesDiv = document.getElementById('messages');
  const inputForm = document.getElementById('inputForm');
  const messageInput = document.getElementById('messageInput');

  function appendMessage(text, sender) {
    const msg = document.createElement('div');
    msg.classList.add('message', sender);
    msg.textContent = text;
    messagesDiv.appendChild(msg);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  let eventSource = null;

  inputForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const message = messageInput.value.trim();
    if (!message) return;
    appendMessage(message, 'user');
    messageInput.value = '';

    if (eventSource) {
      eventSource.close();
      eventSource = null;
    }

    // URL 바꿔서 연결하세요
    const url = 'https://yuchan5386-api-0.hf.space/chat?message=' + encodeURIComponent(message);
    eventSource = new EventSource(url);

    let accumulatedResponse = '';

    eventSource.onopen = () => {
      console.log('SSE 연결됨');
    };

    eventSource.onmessage = (event) => {
      if (event.data === '[DONE]') {
        eventSource.close();
        eventSource = null;
        return;
      }

      const token = event.data;
      if (!accumulatedResponse) {
        accumulatedResponse = token;
      } else if (/^[,\.!?]$/.test(token)) {
        accumulatedResponse += token;
      } else {
        accumulatedResponse += ' ' + token;
      }

      const lastBotMessage = messagesDiv.querySelector('.bot:last-child');
      if (lastBotMessage) {
        lastBotMessage.textContent = accumulatedResponse;
      } else {
        appendMessage(accumulatedResponse, 'bot');
      }
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    };

    eventSource.onerror = (err) => {
      console.error('SSE 에러:', err);
      if (eventSource) {
        eventSource.close();
        eventSource = null;
      }
      appendMessage('❌ 오류가 발생했습니다.', 'bot');
    };
  });
</script>
</body>
</html>
